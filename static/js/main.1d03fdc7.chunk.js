(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(54),s=a.n(r),o=(a(61),a(62),a(4)),c=a.n(o),u=a(8),l=a(2),h=a(3),d=a(6),m=a(5),p=a(7),f=a(10),g=a.n(f),v=g.a.DataFactory,b=v.namedNode,y=(v.literal,v.defaultGraph,v.quad,n.Component,a(82),function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"download",value:function(e){return new Promise(function(t,a){try{fetch(e).then(function(e){t(e.text())}).catch(function(e){console.error(e),a(e)})}catch(n){console.error(e)}})}}]),e}()),T=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"parseAndStoreQuads",value:function(e){return new Promise(function(t){var a=new g.a.Parser,n=new g.a.Store;a.parse(e,function(e,a,i){if(!a)return t({store:n,prefixes:i});n.addQuad(a)})})}},{key:"writeN3Store",value:function(e,t){return new Promise(function(){var a=Object(u.a)(c.a.mark(function a(n){var i,r,s,o,u,l,h;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(i=new g.a.Writer({prefixes:t}),r=!0,s=!1,o=void 0,a.prev=4,u=e.getQuads()[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)h=l.value,i.addQuad(h);a.next=12;break;case 8:a.prev=8,a.t0=a.catch(4),s=!0,o=a.t0;case 12:a.prev=12,a.prev=13,r||null==u.return||u.return();case 15:if(a.prev=15,!s){a.next=18;break}throw o;case 18:return a.finish(15);case 19:return a.finish(12);case 20:return a.next=22,i.end(function(e,t){n(t)});case 22:case"end":return a.stop()}},a,null,[[4,8,12,20],[13,,15,19]])}));return function(e){return a.apply(this,arguments)}}())}},{key:"splitDateInParts",value:function(e){var t={},a=new Date(e);return t.hour=a.getUTCHours(),t.month=a.getUTCMonth(),t.minute=a.getUTCMinutes(),t.day=a.getUTCDay(),t.year=a.getUTCFullYear(),t}}]),e}(),D=g.a.DataFactory.namedNode,E=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"handleFragment",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var a,n,i,r,s,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},n=[],e.next=4,T.parseAndStoreQuads(t);case 4:return i=e.sent,r=i.store,i.prefixes,e.next=9,r.getQuads(null,D("http://www.w3.org/2000/01/rdf-schema#type"),D("https://w3id.org/opentrafficlights#Signalgroup")).forEach(function(e){n.push(e.subject.value)});case 9:return e.next=11,r.getQuads(null,D("http://www.w3.org/ns/prov#generatedAtTime"),null).sort(function(e,t){return(e=new Date(e.object.value).getTime())>(t=new Date(t.object.value).getTime())?-1:e<t?1:0})[0];case 11:return(s=e.sent)&&(o=s.object.value,n.forEach(function(e){var t=r.getQuads(D(e),D("https://w3id.org/opentrafficlights#signalState"),null,s.subject)[0];if(t){var n=r.getQuads(t.object,D("https://w3id.org/opentrafficlights#minEndTime"),null,s.subject)[0].object.value,i=r.getQuads(t.object,D("https://w3id.org/opentrafficlights#maxEndTime"),null,s.subject)[0].object.value,c=r.getQuads(t.object,D("https://w3id.org/opentrafficlights#signalPhase"),null,s.subject)[0].object.value,u=void 0;try{u=r.getQuads(t.object,D("https://w3id.org/opentrafficlights#likelyTime"),null,s.subject)[0].object.value}catch(l){console.log("no likelyTime")}a[e]||(a[e]={}),a[e]={generatedAtTime:o&&new Date(o),minEndTime:n&&new Date(n),maxEndTime:i&&new Date(i),signalPhase:c,likelyTime:u&&new Date(u)}}})),e.abrupt("return",a);case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=(n.Component,a(83),a(13)),j=(a(84),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.count,a=e.color;void 0===t&&(t="X");var n="black";return 0===a&&(n="orange"),3===a&&(n="red"),6===a&&(n="green"),i.a.createElement("div",{className:"Countdown"},i.a.createElement("div",{className:"Countdown_value",style:{color:n}},t))}}]),t}(n.Component)),O=(a(85),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.min,a=e.max;return void 0===t&&(t="X"),void 0===a&&(a="X"),i.a.createElement("div",{className:"MinMaxTable"},i.a.createElement("div",{className:"MinMaxTable_minimum_box"},i.a.createElement("div",{className:"MinMaxTable_minimum_title"},"Minimum"),i.a.createElement("div",{className:"MinMaxTable_minimum_value"},t)),i.a.createElement("div",{className:"MinMaxTable_maximum_box"},i.a.createElement("div",{className:"MinMaxTable_maximum_title"},"Maximum"),i.a.createElement("div",{className:"MinMaxTable_maximum_value"},a)))}}]),t}(n.Component)),x=(a(52),a(9)),k=(a(97),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.minData,a=e.maxData,n=e.likelyData,r=e.title;return i.a.createElement("div",{className:"BarChart"},i.a.createElement("p",null,r),i.a.createElement(x.d,{height:300,width:800,xType:"time"},i.a.createElement(x.a,null),i.a.createElement(x.b,{data:t,barWidth:.95,color:"green"}),i.a.createElement(x.b,{data:a,barWidth:.95,color:"red"}),i.a.createElement(x.b,{data:n,barWidth:.95,color:"blue"}),i.a.createElement(x.c,{title:"Time"}),i.a.createElement(x.e,{title:"Duration (s)"})))}}]),t}(n.Component)),S=(a(98),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.red,a=e.orange,n=e.green,r=e.title;return i.a.createElement("div",{className:"PhaseColorGraph"},i.a.createElement("p",null,r),i.a.createElement(x.d,{height:100,width:800,xType:"time"},i.a.createElement(x.b,{data:t,color:"red"}),i.a.createElement(x.b,{data:a,color:"orange"}),i.a.createElement(x.b,{data:n,color:"green"}),i.a.createElement(x.c,{title:"Time"}),i.a.createElement(x.e,{title:"Color",style:{ticks:{stroke:"none"},text:{stroke:"none",fill:"none"}}})))}}]),t}(n.Component)),P=(a(99),function(e){var t=e.activeValue,a=e.options,n=e.onChange;return i.a.createElement("select",{value:t,onChange:function(e){return n(e.target.value)}},Object.keys(a).map(function(e){return i.a.createElement("option",{value:e,id:e},e)}))}),M=(a(100),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={show:!0},a.onClick=a.onClick.bind(Object(w.a)(a)),a}return Object(p.a)(t,e),Object(h.a)(t,[{key:"onClick",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return!1!==this.state.show?i.a.createElement("div",{className:"ErrorBox_alert"},i.a.createElement("span",{className:"ErrorBox_alertCloseBtn",onClick:this.onClick},"\xd7"),this.props.message):null}}]),t}(n.Component)),G=g.a.DataFactory.namedNode,A=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.a)(this,e),this.phaseStart={},this.lastPhase={},this.lastMaxEndTime={},this.lastMinEndTime={},this.lastObservation={},this.maxDidIncrease={},this.showGeneratedAtTimeErrors=t,this.showPhaseErrors=a,this.startUpObservations=0,this.generatedBeforeLastErrors=0,this.onSamePhaseResets=0,this.onPhaseChangeResets=0,this.observationSameAsLast=0,this.realStartUpObservations=0,this.realStartUp={}}return Object(h.a)(e,[{key:"printDebugInfo",value:function(){console.log("<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),console.log("   FragmentParser debug info:"),console.log("    - startUpObservations (reset included): "+this.startUpObservations),console.log("    - realStartUpObservations (startup only): "+this.realStartUpObservations),console.log("    - generatedBeforeLastErrors: "+this.generatedBeforeLastErrors),console.log("    - observationSameAsLast: "+this.observationSameAsLast),console.log("    - onSamePhaseResets: "+this.onSamePhaseResets),console.log("    - onPhaseChangeResets: "+this.onPhaseChangeResets),console.log("<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>")}},{key:"handleFragment",value:function(){var t=Object(u.a)(c.a.mark(function t(a,n,i,r,s,o,u){var l,h,d,m,p,f,g,v,b=this;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l=e._initReturnObject(),t.next=3,T.parseAndStoreQuads(a);case 3:return h=t.sent,d=h.store,m=h.prefixes,p=[],t.next=9,d.getQuads(null,G("http://www.w3.org/2000/01/rdf-schema#type"),G("https://w3id.org/opentrafficlights#Signalgroup")).forEach(function(e){p.push(e.subject.value),b.phaseStart[e.subject.value]||(b.phaseStart[e.subject.value]=-1),b.lastPhase[e.subject.value]||(b.lastPhase[e.subject.value]=-1),b.lastMaxEndTime[e.subject.value]||(b.lastMaxEndTime[e.subject.value]=-1),b.lastMinEndTime[e.subject.value]||(b.lastMinEndTime[e.subject.value]=-1),b.lastObservation[e.subject.value]||(b.lastObservation[e.subject.value]=void 0),b.maxDidIncrease[e.subject.value]||(b.maxDidIncrease[e.subject.value]={}),b.realStartUp[e.subject.value]||(b.realStartUp[e.subject.value]=0)});case 9:if(f=!0,!n){t.next=15;break}return t.next=13,d.getQuads(null,G("http://www.w3.org/ns/prov#generatedAtTime"),null).sort(function(e,t){return(e=new Date(e.object.value).getTime())<(t=new Date(t.object.value).getTime())?-1:e>t?1:0})[0];case 13:(g=t.sent)?(v="fragment_"+g.object.value.replace(/\:/g,"_").replace(/\./g,"_")+".trig")!==n&&(console.log("\x1b[31m","Filename is not correct: "+n+", first observation: "+v,"\x1b[0m"),f=!1):f=!1;case 15:if(!f){t.next=18;break}return t.next=18,d.getQuads(null,G("http://www.w3.org/ns/prov#generatedAtTime"),null).sort(function(e,t){return(e=new Date(e.object.value).getTime())<(t=new Date(t.object.value).getTime())?-1:e>t?1:0}).forEach(function(t){var a=t.object.value;p.forEach(function(o){var c=0;b.lastObservation[o]&&(new Date(b.lastObservation[o]).getTime()>new Date(a).getTime()&&(b.showGeneratedAtTimeErrors&&console.log(n+" : Observation: "+a+" signalGroup: "+o+" | last observation bigger than new: "+b.lastObservation[o]+" - "+a),b.generatedBeforeLastErrors++,c=1),a===b.lastObservation[o]&&(b.showGeneratedAtTimeErrors&&console.log("generatedAtTime "+a+" is same as last "+b.lastObservation[o]+" sg: "+o),b.observationSameAsLast++));var h=d.getQuads(G(o),G("https://w3id.org/opentrafficlights#signalState"),null,t.subject)[0];if(h){var p=d.getQuads(h.object,G("https://w3id.org/opentrafficlights#minEndTime"),null,t.subject)[0].object.value,f=d.getQuads(h.object,G("https://w3id.org/opentrafficlights#maxEndTime"),null,t.subject)[0].object.value,g=d.getQuads(h.object,G("https://w3id.org/opentrafficlights#signalPhase"),null,t.subject)[0].object.value;a>f&&console.log("fragment contains observation generated after maxEndTime: "+n),-1!==b.phaseStart[o]&&-1!==b.lastPhase[o]?(0===b.realStartUp[o]&&(b.realStartUp[o]=1),b.lastPhase[o]!==g?(s&&(e._setReturnObject(l,o,g,h,a,p,f,t,d,m,a,b.phaseStart[o],b.lastPhase[o],b.maxDidIncrease[o][g]),s(l)),c||(new Date(a).getTime()>new Date(b.lastObservation[o]).getTime()+5e3&&(-1!==b.lastMaxEndTime[o]&&new Date(a).getTime()>new Date(b.lastMaxEndTime[o]).getTime()+210||-1!==b.lastMinEndTime[o]&&a<b.lastMinEndTime[o])?(b.lastPhase[o]=-1,b.phaseStart[o]=-1,b.onPhaseChangeResets++,b.showPhaseErrors&&console.log("onPhaseChangeError: "+n+" generatedAtTime: "+a+" maxEndTime: "+f+" lastMaxEndTime: "+b.lastMaxEndTime[o]+" lastMinEndTime: "+b.lastMinEndTime[o]+" last observation (gereratedAtTime): "+b.lastObservation[o]),u&&u(o),b.lastMaxEndTime[o]=-1,b.lastMinEndTime[o]=-1):(i&&(e._setReturnObject(l,o,g,h,a,p,f,t,d,m,a,b.phaseStart[o],b.lastPhase[o],b.maxDidIncrease[o][g]),i(l)),b.lastPhase[o]=g,b.phaseStart[o]=a,b.lastMaxEndTime[o]=f,b.lastMinEndTime[o]=p))):(s&&(e._setReturnObject(l,o,g,h,a,p,f,t,d,m,b.phaseStart[o],b.phaseStart[o],b.lastPhase[o],b.maxDidIncrease[o][g]),s(l)),c||(new Date(a).getTime()>new Date(b.lastObservation[o]).getTime()+5e3&&(-1!==b.lastMaxEndTime[o]&&new Date(f).getTime()>new Date(b.lastMaxEndTime[o]).getTime()+1005||-1!==b.lastMinEndTime[o]&&new Date(p).getTime()+1005<new Date(b.lastMinEndTime[o]).getTime())?(b.lastPhase[o]=-1,b.phaseStart[o]=-1,b.showPhaseErrors&&console.log("onSamePhaseError: "+n+" generatedAtTime: "+a+" maxEndTime: "+f+" lastMaxEndTime: "+b.lastMaxEndTime[o]+" minEndTime: "+p+" lastMinEndTime: "+b.lastMinEndTime[o]+" last observation (gereratedAtTime): "+b.lastObservation[o]),b.onSamePhaseResets++,u&&u(o),b.lastMaxEndTime[o]=-1,b.lastMinEndTime[o]=-1):(!0!==b.maxDidIncrease[o][g]&&(b.maxDidIncrease[o][g]=new Date(f).getTime()>new Date(b.lastMaxEndTime[o]).getTime()+1005),r&&(e._setReturnObject(l,o,g,h,a,p,f,t,d,m,b.phaseStart[o],b.phaseStart[o],b.lastPhase[o],b.maxDidIncrease[o][g]),r(l)),b.lastMaxEndTime[o]=f,b.lastMinEndTime[o]=p)))):c||(0===b.realStartUp[o]&&b.realStartUpObservations++,b.startUpObservations++,-1===b.phaseStart[o]&&-1===b.lastPhase[o]?b.lastPhase[o]=g:b.lastPhase[o]!==g&&(b.lastPhase[o]=g,b.phaseStart[o]=a),b.lastMaxEndTime[o]=f,b.lastMinEndTime[o]=p),c||(b.lastObservation[o]=a)}})});case 18:o&&(e._setReturnObject(l,void 0,void 0,void 0,void 0,void 0,void 0,void 0,d,m,void 0,void 0,void 0,void 0),o(l));case 19:case"end":return t.stop()}},t)}));return function(e,a,n,i,r,s,o){return t.apply(this,arguments)}}()}],[{key:"_initReturnObject",value:function(){return{signalGroup:void 0,signalPhase:void 0,signalState:void 0,generatedAtTime:void 0,minEndTime:void 0,maxEndTime:void 0,observation:void 0,store:void 0,prefixes:void 0,phaseStart:void 0,lastPhaseStart:void 0,lastPhase:void 0,maxDidIncrease:void 0}}},{key:"_setReturnObject",value:function(e,t,a,n,i,r,s,o,c,u,l,h,d,m){e.signalGroup=t,e.signalPhase=a,e.signalState=n,e.generatedAtTime=i,e.minEndTime=r,e.maxEndTime=s,e.observation=o,e.store=c,e.prefixes=u,e.phaseStart=l,e.lastPhaseStart=h,e.lastPhase=d,e.maxDidIncrease=m}}]),e}(),_=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"calculateMeanDuration",value:function(e){var t=0,a=0;return Object.keys(e).forEach(function(n){a+=e[n],t+=n*e[n]}),0===a?void 0:Math.round(t/a)}},{key:"calculateMedianDuration",value:function(e){var t=0;Object.keys(e).forEach(function(a){t+=e[a]});for(var a=0,n=void 0,i=0,r=Object.keys(e);void 0===n&&i<r.length;)t/2>a&&t/2<=a+e[r[i]]&&(n=r[i]),a+=e[r[i]],i++;return 0===t?void 0:parseInt(n,10)}},{key:"calculatePartDuration",value:function(e,t){var a=0;Object.keys(e).forEach(function(t){a+=e[t]});for(var n=0,i=void 0,r=0,s=Object.keys(e);void 0===i&&r<s.length;)a*t>n&&a*t<=n+e[s[r]]&&(i=s[r]),n+=e[s[r]],r++;return 0===a?void 0:parseInt(i,10)}},{key:"calculateMostCommonDuration",value:function(e){var t=void 0;return Object.keys(e).forEach(function(a){void 0===t?t=a:e[a]>e[t]&&(t=a)}),t}}]),e}(),C=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"predictLikelyTime",value:function(e,t,a,n,i,r,s,o,c){try{if(s&&Object.keys(s).length>0){var u=new Date(r),l=(new Date(a).getTime()-u.getTime())/1e3,h={};Object.keys(s).forEach(function(e){e>=l&&(h[e]=s[e])});var d=void 0,m=o(s);return m<l&&(m=o(h)),void 0!==m&&(u.setTime(u.getTime()+1e3*m),d=u.toISOString()),n&&i&&n===i?d=n:void 0!==d&&d<n?d=n:void 0!==d&&!c&&d>i&&(d=i),d}}catch(p){}}},{key:"predictLikelyTimeSamePrevious",value:function(e,t,a,n,i,r){try{var s=new Date(r),o=void 0,c=e;return void 0!==c&&(s.setTime(s.getTime()+1e3*c),o=s.toISOString()),n&&i&&n===i?o=n:void 0!==o&&o<n?o=n:void 0!==o&&o>i&&(o=i),o}catch(u){}}},{key:"predictLikelyTimeBasedOnPreviousPrediction",value:function(e,t,a,n,i,r,s,o,c){try{if(c&&Object.keys(c).length>0){var u=new Date(o),l=(new Date(i).getTime()-u.getTime())/1e3,h={};Object.keys(c).forEach(function(e){e>l&&(h[e]=c[e])});var d=void 0,m=(t-e)/e,p=_.calculatePartDuration(h,m);return void 0!==p&&(u.setTime(u.getTime()+1e3*p),d=u.toISOString()),r&&s&&r===s?d=r:void 0!==d&&d<r?d=r:void 0!==d&&d>s&&(d=s),d}}catch(f){}}}]),e}(),q=function(){function e(){Object(l.a)(this,e),this.frequencyDistribution={}}return Object(h.a)(e,[{key:"add",value:function(e,t,a,n,i,r,s,o){this.frequencyDistribution[e]||(this.frequencyDistribution[e]={}),this.frequencyDistribution[e][t]||(this.frequencyDistribution[e][t]={}),this.frequencyDistribution[e][t][a]||(this.frequencyDistribution[e][t][a]={}),this.frequencyDistribution[e][t][a][n]||(this.frequencyDistribution[e][t][a][n]={}),this.frequencyDistribution[e][t][a][n][i]||(this.frequencyDistribution[e][t][a][n][i]={}),this.frequencyDistribution[e][t][a][n][i][r]||(this.frequencyDistribution[e][t][a][n][i][r]={}),this.frequencyDistribution[e][t][a][n][i][r][s]||(this.frequencyDistribution[e][t][a][n][i][r][s]={}),this.frequencyDistribution[e][t][a][n][i][r][s][o]?this.frequencyDistribution[e][t][a][n][i][r][s][o]++:this.frequencyDistribution[e][t][a][n][i][r][s][o]=1}},{key:"getDistributions",value:function(){return this.frequencyDistribution}},{key:"get",value:function(e,t,a,n,i,r,s){if(this.frequencyDistribution[e]&&this.frequencyDistribution[e][t]&&this.frequencyDistribution[e][t][a]&&this.frequencyDistribution[e][t][a][n]&&this.frequencyDistribution[e][t][a][n][i]&&this.frequencyDistribution[e][t][a][n][i][r]&&this.frequencyDistribution[e][t][a][n][i][r][s])return this.frequencyDistribution[e][t][a][n][i][r][s]}},{key:"createDistributionsCSV",value:function(){var e=this,t=[];return Object.keys(this.frequencyDistribution).forEach(function(a){Object.keys(e.frequencyDistribution[a]).forEach(function(n){Object.keys(e.frequencyDistribution[a][n]).forEach(function(i){Object.keys(e.frequencyDistribution[a][n][i]).forEach(function(r){Object.keys(e.frequencyDistribution[a][n][i][r]).forEach(function(s){Object.keys(e.frequencyDistribution[a][n][i][r][s]).forEach(function(o){Object.keys(e.frequencyDistribution[a][n][i][r][s][o]).forEach(function(c){var u="signalGroup,signalphase,year,month,day,hour,minutes,duration,amount\n";Object.keys(e.frequencyDistribution[a][n][i][r][s][o][c]).forEach(function(t){u+=a+","+n+","+i+","+r+","+s+","+o+","+c+","+t+","+e.frequencyDistribution[a][n][i][r][s][o][c][t]+"\n"}),t.push(u)})})})})})})}),t}}]),e}(),N=g.a.DataFactory,U=N.namedNode,I=N.literal,Q=function(){function e(){Object(l.a)(this,e),this.realTimeFragmentParser=new A(!1,!1),this.timeDistribution=new q}return Object(h.a)(e,[{key:"generatePredictions",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var a,n=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="",e.next=3,this.realTimeFragmentParser.handleFragment(t,void 0,function(e){var t=e.signalGroup,a=e.signalPhase,i=e.signalState,r=e.generatedAtTime,s=e.minEndTime,o=e.maxEndTime,c=e.observation,u=e.store,l=e.lastPhaseStart,h=e.lastPhase,d=e.phaseStart,m=e.maxDidIncrease,p=T.splitDateInParts(d),f=new Date(r).getTime()-new Date(l).getTime();n.timeDistribution.add(t,h,p.year,p.month,p.day,p.hour,20*Math.floor(p.minute/20),Math.round(f/1e3));var g=n.timeDistribution.get(t,a,p.year,p.month,p.day,p.hour,20*Math.floor(p.minute/20));console.log(g);var v=C.predictLikelyTime(t,a,r,s,o,l,g,_.calculateMedianDuration,m);v&&u.addQuad(i.object,U("https://w3id.org/opentrafficlights#likelyTime"),I(v,U("http://www.w3.org/2001/XMLSchema#date")),c.subject)},function(e){var t=e.signalGroup,a=e.signalPhase,i=e.signalState,r=e.generatedAtTime,s=e.minEndTime,o=e.maxEndTime,c=e.observation,u=e.store,l=e.lastPhaseStart,h=(e.lastPhase,e.phaseStart),d=e.maxDidIncrease,m=T.splitDateInParts(h),p=n.timeDistribution.get(t,a,m.year,m.month,m.day,m.hour,20*Math.floor(m.minute/20));console.log(p);var f=C.predictLikelyTime(t,a,r,s,o,l,p,_.calculateMedianDuration,d);f&&u.addQuad(i.object,U("https://w3id.org/opentrafficlights#likelyTime"),I(f,U("http://www.w3.org/2001/XMLSchema#date")),c.subject)},void 0,function(){var e=Object(u.a)(c.a.mark(function e(t){var n,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,i=t.prefixes,e.next=3,T.writeN3Store(n,i).then(function(e){a=e});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),L=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).DATASET_URL=e.datasetUrl,a._constructGraphData=a._constructGraphData.bind(Object(w.a)(a)),a._constructColorGraphData=a._constructColorGraphData.bind(Object(w.a)(a)),a._constructSignalGroup=a._constructSignalGroup.bind(Object(w.a)(a)),a.setActiveSignalGroup=a.setActiveSignalGroup.bind(Object(w.a)(a)),e.clientSidePrediction&&(a.predictionGenerator=new Q),a.state={clientSidePrediction:e.clientSidePrediction,data:{},colorData:{},colorDataOldest:{},minEndTimeGraphData:{},maxEndTimeGraphData:{},likelyTimeGraphData:{},signalGroups:{},activeSignalGroup:"https://opentrafficlights.org/id/signalgroup/K648/4"},a}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.clientSidePrediction;setInterval(function(){y.download(e.DATASET_URL).then(function(){var a=Object(u.a)(c.a.mark(function a(n){var i;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i=n,!t){a.next=5;break}return a.next=4,e.predictionGenerator.generatePredictions(n);case 4:i=a.sent;case 5:E.handleFragment(i).then(function(t){e.setState({data:t}),e._constructGraphData("minEndTime","minEndTimeGraphData"),e._constructGraphData("maxEndTime","maxEndTimeGraphData"),e._constructGraphData("likelyTime","likelyTimeGraphData"),e._constructColorGraphData(),e._constructSignalGroup(Object.keys(t))});case 6:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()).catch(function(){e.setState({data:{}}),console.error("data error: "+e.DATASET_URL)})},1e3)}},{key:"_constructColorGraphData",value:function(){var e=this.state,t=e.data,a=e.colorData,n=e.colorDataOldest;Object.keys(t).forEach(function(e){if(t[e]){if(a[e]||(a[e]={}),a[e][t[e].signalPhase]||(a[e][t[e].signalPhase]=[]),n[e]||(n[e]=[]),n[e].length>20){var i=n[e].shift();a[e][i].shift()}var r=t[e]&&t[e].generatedAtTime;a[e][t[e].signalPhase].push({x:r,y:1}),n[e].push(t[e].signalPhase)}});var i={};i.colorData=a,i.colorDataOldest=n,this.setState(i)}},{key:"_constructGraphData",value:function(e,t){var a=this.state.data,n=this.state[t];Object.keys(a).forEach(function(t){if(a[t]){n[t]||(n[t]=[]),n[t]&&n[t].length>20&&n[t].shift();var i=a[t]&&a[t].generatedAtTime,r=a[t]&&(new Date(a[t][e]).getTime()-new Date(a[t].generatedAtTime))/1e3;n[t].push({x:i,y:r})}});var i={};i[t]=n,this.setState(i)}},{key:"_constructSignalGroup",value:function(e){var t=this.state,a=t.signalGroups,n=t.activeSignalGroup;e.forEach(function(e){a[e]=0,void 0===n&&(n=e)}),this.setState({signalGroups:a,activeSignalGroup:n})}},{key:"setActiveSignalGroup",value:function(e){console.log(e),this.setState({data:{},colorData:{},colorDataOldest:{},minEndTimeGraphData:{},maxEndTimeGraphData:{},likelyTimeGraphData:{},activeSignalGroup:e})}},{key:"render",value:function(){var e=this.state,t=e.signalGroups,a=e.activeSignalGroup,n=e.data,r=e.minEndTimeGraphData,s=e.maxEndTimeGraphData,o=e.likelyTimeGraphData,c=e.colorData,u=a,l=n[u]&&n[u].likelyTime&&(n[u].likelyTime.getTime()-n[u].generatedAtTime)/1e3;l&&(l=Math.round(10*l)/10);var h=n[u]&&(n[u].minEndTime.getTime()-n[u].generatedAtTime)/1e3,d=n[u]&&(n[u].maxEndTime.getTime()-n[u].generatedAtTime)/1e3,m="-1";n[u]&&("https://w3id.org/opentrafficlights/thesauri/signalphase/6"===n[u].signalPhase||"https://w3id.org/opentrafficlights/thesauri/signalphase/5"===n[u].signalPhase?m=6:"https://w3id.org/opentrafficlights/thesauri/signalphase/3"===n[u].signalPhase||"https://w3id.org/opentrafficlights/thesauri/signalphase/2"===n[u].signalPhase?m=3:"https://w3id.org/opentrafficlights/thesauri/signalphase/0"===n[u].signalPhase&&(m=0));var p=[],f=[],g=[];return c[u]&&Array.prototype.push.apply(p,c[u]["https://w3id.org/opentrafficlights/thesauri/signalphase/3"]),c[u]&&Array.prototype.push.apply(p,c[u]["https://w3id.org/opentrafficlights/thesauri/signalphase/2"]),c[u]&&Array.prototype.push.apply(f,c[u]["https://w3id.org/opentrafficlights/thesauri/signalphase/6"]),c[u]&&Array.prototype.push.apply(f,c[u]["https://w3id.org/opentrafficlights/thesauri/signalphase/5"]),c[u]&&Array.prototype.push.apply(g,c[u]["https://w3id.org/opentrafficlights/thesauri/signalphase/0"]),i.a.createElement("div",{className:"PredictionBox"},i.a.createElement(P,{options:t,activeValue:a,onChange:this.setActiveSignalGroup}),i.a.createElement(j,{count:l,color:m,className:"PredictionBox_Countdown"}),i.a.createElement(O,{min:h,max:d,className:"PredictionBox_MinMaxTable"}),i.a.createElement(k,{minData:r[u],maxData:s[u],likelyData:o[u],className:"PredictionBox_BarChart"}),i.a.createElement(S,{red:p,green:f,orange:g,className:"PredictionBox_PhaseColorGraph"}),i.a.createElement("p",null,"After refresh of the page, it can take a few minutes before the first predictions will appear."),0===Object.keys(n).length&&i.a.createElement(M,{message:"No data returned: "+this.DATASET_URL}))}}]),t}(n.Component);n.Component;var R=function(){return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},i.a.createElement("div",{className:"App-title"},"OpenTrafficLightsPredictor"),i.a.createElement(L,{datasetUrl:"https://lodi.ilabt.imec.be/observer/rawdata/latest",clientSidePrediction:!0})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},56:function(e,t,a){e.exports=a(101)},61:function(e,t,a){},62:function(e,t,a){},70:function(e,t){},72:function(e,t){},82:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){},97:function(e,t,a){},98:function(e,t,a){},99:function(e,t,a){}},[[56,1,2]]]);
//# sourceMappingURL=main.1d03fdc7.chunk.js.map